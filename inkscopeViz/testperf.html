<!doctype  html>

<html   ng-app="PerfApp">
<head>
 <meta charset=utf-8>
    <link rel="stylesheet" type="text/css" media="screen" href="css/testAdmin.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="css/nv.d3.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="css/rickshaw.min.css"/>
    <link rel="stylesheet" href="css/tooltip.css"/>
    <link rel="stylesheet" href="css/animation.css">
    <script src="scripts/angular/angular.min.js"></script>
    <script src="scripts/angular/angular-cookies.min.js"></script>
    <script src="scripts/angular/angular-animate.min.js"></script>
    <script src="scripts/angular-misc/D3Directives.js"></script>
    <script src="scripts/angular-misc/angular-commons.js"></script>
    <script src="scripts/statusApp.js"></script>
    <script type="text/javascript" src="scripts/d3/d3.v3.min.js" charset="utf-8"></script>
    <script src="scripts/d3/common.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <script src="scripts/d3/colorbrewer.js"></script>
    <script src="scripts/d3/rickshaw.min.js"></script>
    <script type="text/javascript" src="scripts/d3/nv.d3.js" charset="utf-8"></script>
</head>
<script>
 Date.prototype.format = function(format) {
        var o = {
          "M+": this.getMonth() + 1,
          // month
          "d+": this.getDate(),
          // day
          "h+": this.getHours(),
          // hour
          "m+": this.getMinutes(),
          // minute
          "s+": this.getSeconds(),
          // second
          "q+": Math.floor((this.getMonth() + 3) / 3),
          // quarter
          "S": this.getMilliseconds()
          // millisecond
      };
      if (/(y+)/.test(format) || /(Y+)/.test(format)) {
          format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
         if (new RegExp("(" + k + ")").test(format)) {
            format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
      }
    }
      return format;
    };

    function timestampformat(timestamp) {
       return (new Date(timestamp)).format("yyyy-MM-dd hh:mm:ss");
    }

  function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
          }

        var StatusApp = angular.module('PerfApp', ['D3Directives','ngCookies','ngAnimate']).filter('bytes', funcBytesFilter).filter('duration', funcDurationFilter);
        StatusApp.controller("histopsList", function ($scope, $http , $cookieStore) {
            var  $page=getQueryString("page");
            var  $host=getQueryString("host");
            if($page==null)
              $page=0;
            if($host==null)
              $host="ubuntu";
            function  SetHeadLine(){
            $http({method:"get",url:"../inkscopeCtrl/ceph/hosts",timeout:4000})
              .success(function ($data){
              var $count=$data.length;
              var $headString="";
              for(var $i=0;$i<$count;$i++){
               if($data[$i]._id!=$host)
                 $headString=$headString+"<a  href=?host="+$data[$i]._id+">"+$data[$i]._id+"</a>";
               else
                 $headString=$headString+$data[$i]._id;
               $headString+="    ";
             }
             document.getElementById("headLine").innerHTML=$headString;
	   });
	}
        
        SetHeadLine();
        histopsList();//申明函数
        setInterval(function () {
          histopsList();
        },10*1000);

	 function  histopsList() {
	     $http({method:"get",url:"../inkscopeCtrl/ceph/histops?host="+$host,timeout:4000})
             .success(function (data) {
                var  len=data.length;
                var dataList=[];
                if(len>0){
                    dataList[0]=data[len-1];
                    dataList[0].timestamp=timestampformat(dataList[0].timestamp);
                }
                $scope.histopsDataList=dataList;
            });
});
        }
     
});
}


</script>
<body  mg-controller="histopsList">
<div id="listpool2">
        <table width="100%" ng-table="tableParams" class="table table-condensed table-hover">

        <tr  align="middle"   width="100%" >
          <td style="text-align:middle">host</td>
         <td style="text-align:middle">timestamp</td>
          <td style="text-align:middle">osd_typeid</td>
          <td style="text-align:middle">received_at</td>
          <td style="text-align:middle">op_epcho</td>
          <td style="text-align:middle">age</td>
          <td style="text-align:middle">type_data</td>
        </tr>
        <tr ng-repeat="data in  histopsDataList"   width="100%" >
          <td data-title="'host'" sortable="'id'">{{data.host.$id}}</td>
            <td data-title="'timestamp'" sortable="'name'">{{data.timestamp}}</td>
            <!--td data-title="'Ruleset'" sortable="'ruleset'">{{pool.ruleset}}</td-->
            <!--td data-title="'Size'" sortable="'size'">{{pool.size}}</td-->
            <td data-title="'osd_typeid'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.osd_typeid}}</td>
            <td data-title="'received_at'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.received_at}}</td>
            <td data-title="'op_epcho'" sortable="'stats.objects'" style="text-align:middle">{{data.op_epcho}}</td>
            <td data-title="'age'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.age}}</td>
            <td data-title="'type_data'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.type_data}}</td>
        </tr>
    </table>
</div>


</body>
</html>
