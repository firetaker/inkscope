<!doctype  html>
<html  ng-app="DistApp">
<head>

 <meta charset=utf-8>
    <link rel="stylesheet" type="text/css" media="screen" href="css/testAdmin.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="css/nv.d3.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="css/rickshaw.min.css"/>
    <link rel="stylesheet" href="css/tooltip.css"/>
    <link rel="stylesheet" href="css/animation.css">
    <script src="scripts/angular/angular.min.js"></script>
    <script src="scripts/angular/angular-cookies.min.js"></script>
    <script src="scripts/angular/angular-animate.min.js"></script>
    <script src="scripts/angular-misc/D3Directives.js"></script>
    <script src="scripts/angular-misc/angular-commons.js"></script>
    <script src="scripts/statusApp.js"></script>
    <script type="text/javascript" src="scripts/d3/d3.v3.min.js" charset="utf-8"></script>
    <script src="scripts/d3/common.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <script src="scripts/d3/colorbrewer.js"></script>

    <script src="scripts/d3/rickshaw.min.js"></script>
    <script type="text/javascript" src="scripts/d3/nv.d3.js" charset="utf-8"></script>
  <style>
      
    </style>

    <script>

      Date.prototype.format = function(format) {
        var o = {
          "M+": this.getMonth() + 1,
          // month
          "d+": this.getDate(),
          // day
          "h+": this.getHours(),
          // hour
          "m+": this.getMinutes(),
          // minute
          "s+": this.getSeconds(),
          // second
          "q+": Math.floor((this.getMonth() + 3) / 3),
          // quarter
          "S": this.getMilliseconds()
          // millisecond
      };
      if (/(y+)/.test(format) || /(Y+)/.test(format)) {
          format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
         if (new RegExp("(" + k + ")").test(format)) {
            format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
      }
    }
      return format;
    };

          function timestampformat(timestamp) {
	      return (new Date(timestamp)).format("yyyy-MM-dd hh:mm:ss");
	  } 
          function getQueryString(name) {
	    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
	    var r = window.location.search.substr(1).match(reg);
	    if (r != null) return unescape(r[2]); return null;
          }

          var StatusApp = angular.module('DistApp', ['D3Directives','ngCookies','ngAnimate']).filter('bytes', funcBytesFilter).filter('duration', funcDurationFilter);
          StatusApp.controller("ListCtrl", function ($scope, $http , $cookieStore) {
            var  $page=getQueryString("page");
            var  $host=getQueryString("host");
            if($page==null)
              $page=0;
            if($host==null)
              $host="ubuntu";
 
        function  SetHeadLine(){
            $http({method:"get",url:"../inkscopeCtrl/ceph/hosts",timeout:4000})
              .success(function ($data){
              var $count=$data.length;
              var $headString="";
              for(var $i=0;$i<$count;$i++){
               if($data[$i]._id!=$host)
                 $headString=$headString+"<a  href=?host="+$data[$i]._id+">"+$data[$i]._id+"</a>";
               else
                 $headString=$headString+$data[$i]._id;
               $headString+="    ";
             }
             document.getElementById("headLine").innerHTML=$headString;
          });
        }
        SetHeadLine();



      ListCtrl();//申明函数
        setInterval(function () {
          ListCtrl();
      },3*1000);

     function  ListCtrl() {
       $http({method:"get",url:"../inkscopeCtrl/ceph/diskstat?host="+$host,timeout:4000})
         .success(function (data) {
            var dataLen=data.length;
            var dataCount=0;
	    if(dataLen!=0)
	      var dataDisk1=data[0].disk.$id;
            for(var i=0;i<dataLen;i++){
               if(data[i].disk.$id==dataDisk1)
                  dataCount++;
	    }
            
            var  dataListNumber=0;
            if(dataCount!=0)
	      dataListNumber=dataLen/dataCount;
            var  dataList=[];
            var  dataStartNumber=(dataCount-1)*dataListNumber;
            for(var  i=dataStartNumber;i<dataLen;i++){
	      dataList[i-dataStartNumber]=data[i];
              dataList[i-dataStartNumber].timestamp=timestampformat(dataList[i-dataStartNumber].timestamp);
            } 
            $scope.dataList=dataList;
	});
     }
});
    </script>
</head>
<body ng-controller="ListCtrl">

<header ng-include src="'partials/header.html'" ng-init="pageTitle='Ceph Disk  Status'"></header>
 <div><h2  id="headLine"></h2></div>

<div>
<!--div id="status"  >{{status}}</div-->
<div id="listpool2">
        <table width="100%" ng-table="tableParams" class="table table-condensed table-hover">

        <tr  align="middle"   width="100%" >
          <td style="text-align:middle">Devices</td>
	  <td style="text-align:middle">timestamp</td>
          <td style="text-align:middle">rkB_s</td>
	  <td style="text-align:middle">rrqm_s</td>
	  <td style="text-align:middle">r_s</td>
	  <td style="text-align:middle">wkB_s</td>
          <td style="text-align:middle">wrqm_s</td>
          <td style="text-align:middle">w_s</td>
        </tr> 
        <tr ng-repeat="data in  dataList"   width="100%" >
          <td data-title="'wkB'" sortable="'id'">{{data.disk.$id}}</td>
            <td data-title="'timestamp'" sortable="'name'">{{data.timestamp}}</td>
            <!--td data-title="'Ruleset'" sortable="'ruleset'">{{pool.ruleset}}</td-->
            <!--td data-title="'Size'" sortable="'size'">{{pool.size}}</td-->
	    <td data-title="'rrqm_s'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.rkB_s}}</td>
            <td data-title="'rrqm_s'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.rrqm_s}}</td>
            <td data-title="'r_s'" sortable="'stats.objects'" style="text-align:middle">{{data.r_s}}</td>
	    <td data-title="'rrqm_s'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.wkB_s}}</td>
            <td data-title="'rrqm_s'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.wrqm_s}}</td>
            <td data-title="'r_s'" sortable="'stats.objects'" style="text-align:middle">{{data.w_s}}</td>
        </tr>
    </table>
</div>
</div>


</body>

</html>
