<!doctype  html>
<html  ng-app="OsdPerfApp">
<head>

 <meta charset=utf-8>
    <link rel="stylesheet" type="text/css" media="screen" href="css/testAdmin.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="css/nv.d3.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="css/rickshaw.min.css"/>
    <link rel="stylesheet" href="css/tooltip.css"/>
    <link rel="stylesheet" href="css/animation.css">
    <script src="scripts/angular/angular.min.js"></script>
    <script src="scripts/angular/angular-cookies.min.js"></script>
    <script src="scripts/angular/angular-animate.min.js"></script>
    <script src="scripts/angular-misc/D3Directives.js"></script>
    <script src="scripts/angular-misc/angular-commons.js"></script>
    <script src="scripts/statusApp.js"></script>
    <script type="text/javascript" src="scripts/d3/d3.v3.min.js" charset="utf-8"></script>
    <script src="scripts/d3/common.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <script src="scripts/d3/colorbrewer.js"></script>

    <script src="scripts/d3/rickshaw.min.js"></script>
    <script type="text/javascript" src="scripts/d3/nv.d3.js" charset="utf-8"></script>
  <style>
      
    </style>

    <script>

      Date.prototype.format = function(format) {
        var o = {
          "M+": this.getMonth() + 1,
          // month
          "d+": this.getDate(),
          // day
          "h+": this.getHours(),
          // hour
          "m+": this.getMinutes(),
          // minute
          "s+": this.getSeconds(),
          // second
          "q+": Math.floor((this.getMonth() + 3) / 3),
          // quarter
          "S": this.getMilliseconds()
          // millisecond
      };
      if (/(y+)/.test(format) || /(Y+)/.test(format)) {
          format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
         if (new RegExp("(" + k + ")").test(format)) {
            format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
      }
    }
      return format;
    };

          function timestampformat(timestamp) {
	      return (new Date(timestamp)).format("yyyy-MM-dd hh:mm:ss");
	  } 
          function getQueryString(name) {
	    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
	    var r = window.location.search.substr(1).match(reg);
	    if (r != null) return unescape(r[2]); return null;
          }

          var StatusApp = angular.module('OsdPerfApp', ['D3Directives','ngCookies','ngAnimate']).filter('bytes', funcBytesFilter).filter('duration', funcDurationFilter);
          StatusApp.controller("OsdCtrl", function ($scope, $http , $cookieStore) {
      
            var  $page=getQueryString("page");
            var  $host=getQueryString("host");
            if($page==null)
              $page=1;
            if($host==null)
              $host="ubuntu";
           var  $pageNumber=20;
           var  $skip=$page-1;
           var  $limit=$pageNumber;
           if($page==1)
              $scope.leftPage=1;
           else
              $scope.leftPage=$page-1;
           $scope.rightPage=$page-1+2;
      
        function  SetHeadLine(){
            $http({method:"get",url:"../inkscopeCtrl/ceph/hosts",timeout:4000})
              .success(function ($data){
              var $count=$data.length;
              var $headString="";
              for(var $i=0;$i<$count;$i++){
               if($data[$i]._id!=$host)
                 $headString=$headString+"<a  href=?host="+$data[$i]._id+">"+$data[$i]._id+"</a>";
               else
                 $headString=$headString+$data[$i]._id;
               $headString+="    ";
             }
             document.getElementById("headLine").innerHTML=$headString;
          });
        }
        SetHeadLine();

	

      PgCtrl();//申明函数
        setInterval(function () {
          PgCtrl();
      },3*1000);

     function  PgCtrl() {
       $http({method:"get",url:"../inkscopeCtrl/ceph/osdperf?skip="+$skip+"&limit="+$limit+"&host="+$host,timeout:4000})
         .success(function (data) {
            $scope.dataList=data;
	});
     }
});
    </script>
</head>
<body ng-controller="OsdCtrl">

<header ng-include src="'partials/header.html'" ng-init="pageTitle='Ceph Disk  Status'"></header>
 <div><h2  id="headLine"></h2></div>

<div>
<!--div id="status"  >{{status}}</div-->
<div id="listpool2">
        <table width="100%" ng-table="tableParams" class="table table-condensed table-hover">

        <tr  align="middle"   width="100%" >
          <td style="text-align:middle">id</td>
          <td style="text-align:middle">time</td>
	  <td style="text-align:middle">apply_latency_ms</td>
          <td style="text-align:middle">commit_latency_ms</td>
        </tr> 
        <tr ng-repeat="data in  dataList"   width="100%" >
            <td data-title="'ondisk_log_start'" sortable="'name'">{{data.osdtypeid}}</td>
	    <td data-title="'ondisk_log_start'" sortable="'name'">{{data.timestamp}}</td>
            <!--td data-title="'Ruleset'" sortable="'ruleset'">{{pool.ruleset}}</td-->
            <!--td data-title="'Size'" sortable="'size'">{{pool.size}}</td-->
	    <td data-title="'last_scrub'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.perf_stats.apply_latency_ms}}</td>
            <td data-title="'last_clean_scrub_stamp'" sortable="'stats.bytes_used'" style="text-align:middle">{{data.perf_stats.commit_latency_ms}}</td>
</tr>
</table>
</div>
<table align="middle">
<tr  align="middle">
<td><a  href="?page={{leftPage}}">上一页</a></td>
<td><a  href="?page={{rightPage}}">下一页</a></td>
</tr>
</table>
</div>


</body>

</html>
